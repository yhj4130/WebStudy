<%@page import="java.sql.ResultSet"%>
<%@page import="java.sql.PreparedStatement"%>
<%@page import="java.sql.Connection"%>
<%@page import="java.sql.DriverManager"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Insert title here</title>
</head>
<body>
<!-- list.jsp -->

<%
	// 1. 
	Class.forName("oracle.jdbc.driver.OracleDriver");
	System.out.println("JDBC 드라이버 로드 성공");

	// 2. 
	Connection con = DriverManager.getConnection("jdbc:oracle:thin:@localhost:1521:xe", "jsp3c", "1234");
	System.out.println("데이터베이스 연결 성공");

	// 3.
	// 아이디순으로 오름차순 정렬
	String sql = "select * from users order by id ASC";
	PreparedStatement pstmt = con.prepareStatement(sql);

	// 4.
	ResultSet rs = pstmt.executeQuery();	// 실행할 문장이 select이기 때문에 executeQuery() 사용
%>

<form>
	<fieldset>
		<legend>회원관리 시스템</legend>
			<h1>회원 리스트</h1>
			
			<table border="1">
				<tr>
					<th>아이디</th>
					<th>이름</th>
					<th>주소</th>
					<th>성별</th>
					<th>나이</th>
					<th>가입일</th>
					<th>삭제</th>
				</tr>
				<%
					while(rs.next()) {	// boolean 타입일 경우에만 생략 가능 (== true)
				%>
				<tr>
					<td><% out.print(rs.getString("id")); %></td>
					<td><%= rs.getString("name") %></td>
					<td><%= rs.getString("address") %></td>
					<td><%= rs.getString("gender") %></td>
					<td><%= rs.getString("age") %></td>
					<td><%= rs.getDate("reg_date") %></td>
					<td><a href="delete?id=<%= rs.getString("id") %>">삭제</a></td>
				</tr>
				<%
					}
				%>
			</table>
	</fieldset>
</form>

<%
	rs.close();
	pstmt.close();
	con.close();
%>

</body>
</html>